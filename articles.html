<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>足部健康專區 - Med Times</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#679396',
                        'primary-dark': '#3a5e5f',
                        'bg-main': '#F5F5F5',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    },
                    borderRadius: {
                        'xl': '1rem',
                        '2xl': '1.5rem',
                        '3xl': '2rem',
                    }
                }
            }
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">

    <script>
    // 1. 載入 Header/Footer
    async function loadHTML(selector, url) {
        try {
            const resp = await fetch(url);
            const text = await resp.text();
            document.querySelector(selector).innerHTML = text;
            if (selector === '#header' && typeof initMobileMenu === 'function') {
                initMobileMenu();
            }
        } catch (error) {
            console.error(`載入 ${url} 失敗:`, error);
        }
    }

    // ★ 核心函式：取得 'foot-health' 標籤的 ID 並抓文章
    async function fetchFootHealthArticles() {
        const container = document.getElementById('articles-container');
        if (!container) return;

        // 步驟 1: 設定我們要找的標籤代號 (Slug)
        const targetSlug = 'foot-health';
        const baseUrl = 'https://medtimes.com.tw/wp-json/wp/v2';

        try {
            // 步驟 2: 先問 API 這個標籤的 ID 是多少
            // 搜尋 tags 中 slug 等於 'foot-health' 的項目
            const tagResp = await fetch(`${baseUrl}/tags?slug=${targetSlug}`);
            const tags = await tagResp.json();

            if (tags.length === 0) {
                console.warn('找不到 foot-health 標籤，無法篩選。');
                container.innerHTML = `<p class="col-span-full text-center text-gray-500">目前無法取得足健康分類文章。</p>`;
                return;
            }

            const tagId = tags[0].id; // 取得 ID
            console.log(`抓到標籤 ID: ${tagId} (${tags[0].name})`);

            // 步驟 3: 使用這個 ID 來抓文章 (tags=ID)
            // _embed 參數是為了抓圖片
            const postsResp = await fetch(`${baseUrl}/posts?tags=${tagId}&per_page=6&_embed`);
            if (!postsResp.ok) throw new Error('文章 API 連線失敗');
            
            const posts = await postsResp.json();

            // 步驟 4: 清空 Loading 畫面並渲染文章
            container.innerHTML = ''; 

            if (posts.length === 0) {
                container.innerHTML = `<p class="col-span-full text-center text-gray-500">此分類目前沒有文章。</p>`;
                return;
            }

            posts.forEach(post => {
                // 處理特色圖片 (如果沒有就用預設圖)
                let imgUrl = 'https://via.placeholder.com/600x400?text=MedTimes';
                if (post._embedded && post._embedded['wp:featuredmedia'] && post._embedded['wp:featuredmedia'][0]) {
                    imgUrl = post._embedded['wp:featuredmedia'][0].source_url;
                }

                // 處理日期
                const dateObj = new Date(post.date);
                const dateStr = `${dateObj.getFullYear()}.${(dateObj.getMonth()+1).toString().padStart(2, '0')}.${dateObj.getDate().toString().padStart(2, '0')}`;

                // 處理分類名稱 (顯示在卡片上的小字)
                let categoryName = '醫療專欄';
                if (post._embedded && post._embedded['wp:term']) {
                    const cats = post._embedded['wp:term'].flat().filter(t => t.taxonomy === 'category');
                    if (cats.length > 0) categoryName = cats[0].name;
                }

                const html = `
                    <article class="group flex flex-col h-full bg-transparent">
                        <a href="${post.link}" target="_blank" class="block relative h-64 overflow-hidden rounded-3xl transition-transform duration-300 transform group-hover:-translate-y-2 shadow-sm">
                            <img src="${imgUrl}" alt="${post.title.rendered}" class="w-full h-full object-cover">
                            <div class="absolute top-4 left-4 bg-primary text-white text-xs px-3 py-1 rounded-full shadow-md">
                                足健康
                            </div>
                        </a>
                        
                        <div class="pt-6 flex-1 flex flex-col justify-between">
                            <div>
                                <div class="flex items-center space-x-3 text-sm text-gray-400 font-light mb-3">
                                    <p>${dateStr}</p>
                                    <span class="text-primary">|</span>
                                    <span class="hover:text-primary transition">${categoryName}</span>
                                </div>
                                <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-3 leading-snug line-clamp-2 group-hover:text-primary transition-colors">
                                    <a href="${post.link}" target="_blank">${post.title.rendered}</a>
                                </h2>
                                <div class="text-gray-600 font-light leading-relaxed mb-6 line-clamp-3 text-sm md:text-base">
                                    ${post.excerpt.rendered}
                                </div>
                            </div>
                            <div class="mt-auto">
                                <a href="${post.link}" target="_blank" class="inline-flex items-center text-primary font-medium hover:underline tracking-wider text-sm">
                                    閱讀更多 <i class="fa-solid fa-arrow-right ml-2 text-xs"></i>
                                </a>
                            </div>
                        </div>
                    </article>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });

        } catch (error) {
            console.error('API 錯誤:', error);
            container.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <p class="text-gray-400 mb-4">無法載入文章資料。</p>
                    <a href="https://medtimes.com.tw/tag/foot-health/" target="_blank" class="text-primary border-b border-primary hover:opacity-80">前往 Med Times 官網查看</a>
                </div>
            `;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadHTML('#header', 'partials/header.html');
        loadHTML('#footer', 'partials/footer.html');
        // 執行抓取
        fetchFootHealthArticles();
    });
    </script>
</head>

<body class="bg-[#F5F5F5]">
    <div id="header" class="fixed top-0 left-0 right-0 z-50 bg-[#F5F5F5]/90 backdrop-blur-md shadow-sm"></div>

    <main class="max-w-screen-xl mx-auto px-6 md:px-12 py-32 md:py-48">
        <div class="mb-16 md:mb-24 flex flex-col md:flex-row md:items-end justify-between gap-6">
            <div>
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 tracking-tight leading-tight mb-4">
                    足部健康專欄
                </h1>
                <div class="w-16 h-1 bg-primary mb-4"></div>
                <p class="text-gray-500 font-light max-w-2xl">
                    精選 Med Times 關於足部護理、病症解析與復健運動的專業文章。
                </p>
            </div>
            <a href="https://medtimes.com.tw/tag/foot-health/" target="_blank" class="hidden md:inline-flex items-center text-gray-400 hover:text-primary transition text-sm">
                查看更多 <i class="fa-solid fa-external-link-alt ml-2"></i>
            </a>
        </div>

        <div id="articles-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 md:gap-12 mb-32">
            <div class="col-span-full flex flex-col items-center justify-center text-gray-400 py-20 min-h-[300px]">
                <i class="fa-solid fa-circle-notch fa-spin text-4xl mb-4 text-primary/50"></i>
                <p class="font-light tracking-wider">正在載入足健康專欄文章...</p>
            </div>
        </div>
    </main>

    <div id="footer"></div>
</body>
</html>